<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@faceteer/facet</title><meta name="description" content="Documentation for @faceteer/facet"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@faceteer/facet</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@faceteer/facet</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#faceteer" id="faceteer" style="color: inherit; text-decoration: none;">
  <h1>Faceteer</h1>
</a>
<p><a href="https://codecov.io/gh/faceteer/facet"><img src="https://codecov.io/gh/faceteer/facet/branch/main/graph/badge.svg?token=ORKKZWL5N6" alt="codecov"></a>
<a href="https://github.com/faceteer/facet/actions/workflows/test.yml"><img src="https://github.com/faceteer/facet/actions/workflows/test.yml/badge.svg" alt="Test"></a>
<a href="https://www.npmjs.com/package/@faceteer/facet"><img src="https://img.shields.io/npm/v/@faceteer/facet" alt="npm version"></a></p>
<p>Faceteer is meant to make it easier to work with a single-table DynamoDB architecture.</p>
<p>The structure and records that are kept in a Dynamo DB table are more so designed around how you access the data instead of the structure of the data itself.</p>
<p>If you&#39;re not familiar with the Dynamo DB single table concepts, this video is a good starting point.</p>
<p><a href="https://www.youtube.com/watch?v=6yqfmXiZTlM">Amazon DynamoDB deep dive</a></p>

<a href="#getting-started" id="getting-started" style="color: inherit; text-decoration: none;">
  <h2>Getting Started</h2>
</a>
<p>This document aims to be a gentle introduction to the framework and its features.</p>
<p>We will be creating a</p>

<a href="#install" id="install" style="color: inherit; text-decoration: none;">
  <h3>Install</h3>
</a>
<p>Install with npm:</p>
<pre><code><span class="hl-2">npm</span><span class="hl-1"> </span><span class="hl-2">i</span><span class="hl-1"> @</span><span class="hl-2">faceteer</span><span class="hl-1">/</span><span class="hl-2">facet</span><span class="hl-1"> --</span><span class="hl-2">save</span>
</code></pre>

<a href="#access-patterns" id="access-patterns" style="color: inherit; text-decoration: none;">
  <h3>Access Patterns</h3>
</a>
<p>Knowing and identifying your access patterns for your application is critical for a single-table design. Faceteer is not well suited for ad-hoc queries.</p>
<p>In our example we will be creating an application that keeps track of tasks for a team of people.</p>
<p>Our application should support multiple teams, teams should have have multiple users, and team tasks should be either unassigned or assigned to an individual user.</p>
<p>The access patterns we need to support are:</p>
<ul>
<li><em>&quot;Get a team by it&#39;s id&quot;</em></li>
<li><em>&quot;Get a user by their id&quot;</em></li>
<li><em>&quot;Get a user by their email address&quot;</em></li>
<li><em>&quot;Get a task by it&#39;s id&quot;</em></li>
<li><em>&quot;List users by team ordered by the date they were created&quot;</em></li>
<li><em>&quot;List tasks by team ordered by the date they were created&quot;</em></li>
<li><em>&quot;List tasks by team ordered by the date they are due&quot;</em></li>
<li><em>&quot;List tasks by user and by status ordered by the date they were created&quot;</em></li>
<li><em>&quot;List tasks by user and by status ordered by the date they are due&quot;</em></li>
</ul>
<p>Here are the types we will use for our application:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">Team</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">teamName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateCreated</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateDeleted</span><span class="hl-1">?: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">User</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">userId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">email</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">password</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateCreated</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateDeleted</span><span class="hl-1">?: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">Task</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">taskId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">assignedUserId</span><span class="hl-1">?: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateCreated</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateDue</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">status</span><span class="hl-1">: </span><span class="hl-3">&quot;open&quot;</span><span class="hl-1"> | </span><span class="hl-3">&quot;completed&quot;</span><span class="hl-1"> | </span><span class="hl-3">&quot;deleted&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#validation" id="validation" style="color: inherit; text-decoration: none;">
  <h3>Validation</h3>
</a>
<p>Faceteer requires validation when reading records from the Dynamo DB table.</p>
<p>This is done using a validator function that is passed into a facet when constructing it.</p>
<p>The function should be able to take an unkown input and return an object that matches the model for the facet or throw an error if the input is invalid.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">AJV</span><span class="hl-1">, { </span><span class="hl-2">JSONSchemaType</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;ajv&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">interface</span><span class="hl-1"> </span><span class="hl-5">Team</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">teamName</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateCreated</span><span class="hl-1">: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-2">dateDeleted</span><span class="hl-1">?: </span><span class="hl-5">Date</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-9">// Here we use AJV to define the schema for a team</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">schema</span><span class="hl-1">: </span><span class="hl-5">JSONSchemaType</span><span class="hl-1">&lt;</span><span class="hl-5">Team</span><span class="hl-1">&gt; = {</span><br/><span class="hl-1">  </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;object&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">additionalProperties:</span><span class="hl-1"> </span><span class="hl-4">false</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">properties:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">teamId:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;string&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-2">teamName:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;string&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-2">dateCreated:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;object&quot;</span><span class="hl-1">, </span><span class="hl-2">format:</span><span class="hl-1"> </span><span class="hl-3">&quot;date-time&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-2">dateDeleted:</span><span class="hl-1"> { </span><span class="hl-2">type:</span><span class="hl-1"> </span><span class="hl-3">&quot;object&quot;</span><span class="hl-1">, </span><span class="hl-2">format:</span><span class="hl-1"> </span><span class="hl-3">&quot;date-time&quot;</span><span class="hl-1">, </span><span class="hl-2">nullable:</span><span class="hl-1"> </span><span class="hl-4">true</span><span class="hl-1"> },</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">required:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;teamName&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;dateCreated&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">};</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">validateTeam</span><span class="hl-1"> = </span><span class="hl-2">ajv</span><span class="hl-1">.</span><span class="hl-7">compile</span><span class="hl-1">(</span><span class="hl-2">schema</span><span class="hl-1">);</span><br/><br/><span class="hl-9">// We&#39;ll pass this function to our Facet for validating records from the DB</span><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">teamValidator</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1">: </span><span class="hl-5">unknown</span><span class="hl-1">): </span><span class="hl-5">Team</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-7">validateTeam</span><span class="hl-1">(</span><span class="hl-2">input</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">input</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">validateTeam</span><span class="hl-1">.</span><span class="hl-2">errors</span><span class="hl-1">[</span><span class="hl-8">0</span><span class="hl-1">];</span><br/><span class="hl-1">}</span><br/><span class="hl-1">...</span>
</code></pre>

<a href="#creating-a-facet" id="creating-a-facet" style="color: inherit; text-decoration: none;">
  <h3>Creating a Facet</h3>
</a>
<p>Let&#39;s create our facets! Since all of our application logic is isolated by team, we&#39;ll use the team id as the partition for all of our models.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Facet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@faceteer/facet&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">teamValidator</span><span class="hl-1">, </span><span class="hl-2">userValidator</span><span class="hl-1">, </span><span class="hl-2">taskValidator</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./models&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">DynamoDB</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;aws-sdk&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">dynamoDbClient</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">DynamoDB</span><span class="hl-1">();</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">dynamoDbTableName</span><span class="hl-1"> = </span><span class="hl-3">&quot;ExampleTableName&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-9">// Facet containing our teams</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TeamFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-3">&quot;TableName&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">DynamoDB</span><span class="hl-1">(),</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">teamValidator</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Facet containing our users</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">UserFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;userId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#USER&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbTableName</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">userValidator</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-9">// Facet containing our tasks</span><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TaskFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;taskId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbTableName</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">taskValidator</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#putting-records" id="putting-records" style="color: inherit; text-decoration: none;">
  <h3>Putting Records</h3>
</a>
<p>Now we can insert a team into our table.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">nanoid</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;nanoid&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">TeamFacet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./facets&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> { </span><span class="hl-2">Team</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./models&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">team</span><span class="hl-1">: </span><span class="hl-5">Team</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-2">teamId:</span><span class="hl-1"> </span><span class="hl-7">nanoid</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-2">teamName:</span><span class="hl-1"> </span><span class="hl-3">&quot;Penguin Popsicles&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">dateCreated:</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Date</span><span class="hl-1">(),</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">putResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">TeamFacet</span><span class="hl-1">.</span><span class="hl-7">put</span><span class="hl-1">(</span><span class="hl-2">team</span><span class="hl-1">);</span><br/><br/><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">wasSuccessful</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-9">// `record` will contain the record that was</span><br/><span class="hl-1">  </span><span class="hl-9">// put into the database</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">record</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-0">else</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-9">// If there is an issue putting the record into</span><br/><span class="hl-1">  </span><span class="hl-9">// the database the error will be attached to `error`</span><br/><span class="hl-1">  </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">error</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>We can also put several records at once. Faceteer will handle batching the put requests.</p>
<p>Let&#39;s make a function to create multiple users.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">nanoid</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;nanoid&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">UserFacet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./facets&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> { </span><span class="hl-2">User</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./models&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">createNewUsers</span><span class="hl-1">(</span><span class="hl-2">usersToCreate</span><span class="hl-1">: </span><span class="hl-5">Omit</span><span class="hl-1">&lt;</span><span class="hl-5">User</span><span class="hl-1">, </span><span class="hl-3">&quot;userId&quot;</span><span class="hl-1">&gt;[]) {</span><br/><span class="hl-1">  </span><span class="hl-9">// Generate new unique IDs for users</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">users</span><span class="hl-1">: </span><span class="hl-5">User</span><span class="hl-1">[] = </span><span class="hl-2">usersToCreate</span><span class="hl-1">.</span><span class="hl-7">map</span><span class="hl-1">((</span><span class="hl-2">userToCreate</span><span class="hl-1">) </span><span class="hl-4">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-2">userId:</span><span class="hl-1"> </span><span class="hl-7">nanoid</span><span class="hl-1">(),</span><br/><span class="hl-1">    ...</span><span class="hl-2">userToCreate</span><span class="hl-1">,</span><br/><span class="hl-1">  }));</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Save the new users to Dynamo DB</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">putResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">UserFacet</span><span class="hl-1">.</span><span class="hl-7">put</span><span class="hl-1">(</span><span class="hl-2">users</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Check to see if any of the put requests failed</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (</span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">hasFailures</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">for</span><span class="hl-1"> (</span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">putFailure</span><span class="hl-1"> </span><span class="hl-4">of</span><span class="hl-1"> </span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">failed</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">handleFailure</span><span class="hl-1">(</span><span class="hl-2">putFailures</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Return the users that were successfully created</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">putResult</span><span class="hl-1">.</span><span class="hl-2">put</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>

<a href="#getting-records" id="getting-records" style="color: inherit; text-decoration: none;">
  <h3>Getting Records</h3>
</a>
<p>Getting records from a Facet requires any properties that are used in the partition key <em>AND</em> the sort key.</p>
<p>This is because Dynamo DB uniquely identifies records in a table by the combination of both keys.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">UserFacet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./facets&quot;</span><span class="hl-1">;</span><br/><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-0">type</span><span class="hl-1"> { </span><span class="hl-2">User</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./models&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">getUser</span><span class="hl-1">(</span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">, </span><span class="hl-2">userId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-9">// Since `teamId` and `userId` are used by the UserFacet to</span><br/><span class="hl-1">  </span><span class="hl-9">// create the partition and sort keys, both must be provided</span><br/><span class="hl-1">  </span><span class="hl-9">// to get the user record</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">user</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">UserFacet</span><span class="hl-1">.</span><span class="hl-7">get</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1">, </span><span class="hl-2">userId</span><span class="hl-1"> });</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// If there is no record matching the combined partition and sort</span><br/><span class="hl-1">  </span><span class="hl-9">// keys faceteer will return null</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">user</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-0">throw</span><span class="hl-1"> </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Error</span><span class="hl-1">(</span><span class="hl-3">&quot;User not found&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">user</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code></pre>
<p>A get request will always return exactly one record, or a <code>null</code> value.</p>

<a href="#querying" id="querying" style="color: inherit; text-decoration: none;">
  <h3>Querying</h3>
</a>
<p>Querying for records happens in two parts.</p>
<p>First you must specify which partition you want to query.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">UserFacet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./facets&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">getUsersForTeam</span><span class="hl-1">(</span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">partition</span><span class="hl-1"> = </span><span class="hl-2">UserFacet</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1"> });</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Then you specify the query operation you want to run against that partition.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">UserFacet</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;./facets&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">getUsersForTeam</span><span class="hl-1">(</span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-9">// You can store a partition in a variable to re-use it</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">teamPartition</span><span class="hl-1"> = </span><span class="hl-2">UserFacet</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-6">records</span><span class="hl-1">, </span><span class="hl-6">cursor</span><span class="hl-1"> } = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">teamPartition</span><span class="hl-1">.</span><span class="hl-7">list</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-9">// Or you can call an operation on a partition directly</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> { </span><span class="hl-6">records</span><span class="hl-1">, </span><span class="hl-6">cursor</span><span class="hl-1"> } = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">UserFacet</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1"> }).</span><span class="hl-7">list</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> { </span><span class="hl-2">users:</span><span class="hl-1"> </span><span class="hl-2">records</span><span class="hl-1">, </span><span class="hl-2">cursor</span><span class="hl-1"> };</span><br/><span class="hl-1">}</span>
</code></pre>
<p>You can query in the following ways:</p>
<ul>
<li><p><code>equals(key)</code></p>
<ul>
<li>Returns records with sort keys that exactly match the specified sort key.</li>
</ul>
</li>
<li><p><code>greaterThan(key)</code></p>
<ul>
<li>Returns records with sort keys that are greater than the specified sort key.</li>
</ul>
</li>
<li><p><code>greaterThanOrEqual(key)</code></p>
<ul>
<li>Returns records with sort keys that are greater than or equal to the specified sort key.</li>
</ul>
</li>
<li><p><code>lessThan(key)</code></p>
<ul>
<li>Returns records with sort keys that are less than the specified sort key.</li>
</ul>
</li>
<li><p><code>lessThanOrEqual(key)</code></p>
<ul>
<li>Returns records with sort keys that are less than or equal to the specified sort key.</li>
</ul>
</li>
<li><p><code>beginsWith(key)</code></p>
<ul>
<li>Returns records with sort keys that begin with the specified sort key.</li>
</ul>
</li>
<li><p><code>between(startKey, endKey)</code></p>
<ul>
<li>Returns records with sort keys that are greater than or equal to the start key, and are less than or equal to the end key.</li>
</ul>
</li>
<li><p><code>list()</code></p>
<ul>
<li>Returns records where the sort key starts with the facet prefix for that sort key</li>
</ul>
</li>
<li><p><code>first()</code></p>
<ul>
<li>Equivalent to calling <code>list()</code> and selecting the first option</li>
</ul>
</li>
</ul>
<p>The results will always be ordered by the sort key.</p>
<p>One of our access patterns was <em>&quot;List users by team ordered by the date created&quot;</em>, but our sort key is ordered by the <code>userId</code>.</p>
<p>One option would be to include the user&#39;s <code>dateCreated</code> as a part of the sort key for a user.</p>
<pre><code class="language-diff"><span class="hl-1">const UserFacet = new Facet({</span><br/><span class="hl-1">  PK: {</span><br/><span class="hl-1">    keys: [&quot;teamId&quot;],</span><br/><span class="hl-1">    prefix: &quot;#TEAM&quot;,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  SK: {</span><br/><span class="hl-3">-    keys: [&quot;userId&quot;],</span><br/><span class="hl-8">+    keys: [&quot;dateCreated&quot;, &quot;userId&quot;],</span><br/><span class="hl-1">    prefix: &quot;#USER&quot;,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  connection: {</span><br/><span class="hl-1">    dynamoDb: dynamoDbClient,</span><br/><span class="hl-1">    tableName: dynamoDbTableName,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  validator: userValidator,</span><br/><span class="hl-1">});</span>
</code></pre>
<p>We have some restrictions to consider before using this approach though.</p>
<ol>
<li>Partition and sort keys are <strong>IMMUTABLE</strong> and cannot be changed.</li>
<li>You <strong>MUST</strong> provide all properties that make up a partition and sort key when getting a record by it&#39;s ID.</li>
</ol>
<p>The first restriction is probably fine for this use case since it&#39;s unlikely that we&#39;ll ever change the users created date, but it is clunky to identify a user by when they were created.</p>
<p>The second restriction ends up being problematic for us here. It would be cumbersome to have to provide the date that a user was created every time you want to get that user by their ID.</p>
<p>Another option is to prefix a user&#39;s ID with the date whenever you create a user. Let&#39;s re-visit our <code>createNewUsers()</code> function from earlier.</p>
<pre><code class="language-diff"><span class="hl-1">const users: User[] = usersToCreate.map((userToCreate) =&gt; ({</span><br/><span class="hl-3">-  userId: nanoid(),</span><br/><span class="hl-8">+  userId: userToCreate.dateCreated.getTime().toString(36) + nanoid(),</span><br/><span class="hl-1">  ...userToCreate,</span><br/><span class="hl-1">}));</span>
</code></pre>
<p>Now the <code>userId</code> will start with a base 36 representation of when the user was created, ordering our sort key!</p>
<p>While this is a helpful technique, in many cases we won&#39;t be able to modify the sort key for the table to be ordered exactly how we need it.</p>
<p>To enable other access patterns we often have to use indexes...</p>

<a href="#indexes" id="indexes" style="color: inherit; text-decoration: none;">
  <h3>Indexes</h3>
</a>
<p>Dynamo DB uses Global Secondary Indexes (GSIs) to allow for repartitioning and resorting of data in a table. This is what allows us to add more access patterns for our facets.</p>
<p>Let&#39;s take a look at the four access patterns we need for our tasks:</p>
<ul>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they were created&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they are due&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they were created&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they are due&quot;</em></li>
</ul>
<p>Here is our facet:</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TaskFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;taskId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbTableName</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">taskValidator</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Currently we can only list tasks for a team ordered by the task ids.</p>
<p>First we can use the trick with sequential time ids to allow have the task id sort order match the task created at sort order. This covers one of our access patterns</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they were created&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they are due&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they were created&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they are due&quot;</em></li>
</ul>
<p>To get tasks by team ordered by due date we&#39;ll have to configure a GSI using the <code>addIndex()</code> command.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Facet</span><span class="hl-1">, </span><span class="hl-2">Index</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@faceteer/facet&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TaskFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;taskId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbTableName</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">taskValidator</span><span class="hl-1">,</span><br/><span class="hl-1">}).</span><span class="hl-7">addIndex</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">index:</span><span class="hl-1"> </span><span class="hl-2">Index</span><span class="hl-1">.</span><span class="hl-6">GSI1</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;dateDue&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK_DUE&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">alias:</span><span class="hl-1"> </span><span class="hl-3">&quot;byTeamDueDate&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code></pre>
<p>Now we can use <code>GSI1</code> to query for our tasks ordered by their due date!</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">getTeamTasks</span><span class="hl-1">(</span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">queryResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">TaskFacet</span><span class="hl-1">.</span><span class="hl-6">GSI1</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1"> }).</span><span class="hl-7">list</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">tasks:</span><span class="hl-1"> </span><span class="hl-2">queryResult</span><span class="hl-1">.</span><span class="hl-2">records</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">cursor:</span><span class="hl-1"> </span><span class="hl-2">queryResult</span><span class="hl-1">.</span><span class="hl-2">cursor</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code></pre>
<p>Or we can get any tasks that are past due.</p>
<pre><code class="language-ts"><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">async</span><span class="hl-1"> </span><span class="hl-4">function</span><span class="hl-1"> </span><span class="hl-7">getPastDueTasks</span><span class="hl-1">(</span><span class="hl-2">teamId</span><span class="hl-1">: </span><span class="hl-5">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">today</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-5">Date</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">queryResult</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">TaskFacet</span><span class="hl-1">.</span><span class="hl-6">GSI1</span><span class="hl-1">.</span><span class="hl-7">query</span><span class="hl-1">({ </span><span class="hl-2">teamId</span><span class="hl-1"> }).</span><span class="hl-7">lessThan</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">dateDue:</span><span class="hl-1"> </span><span class="hl-2">today</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">tasks:</span><span class="hl-1"> </span><span class="hl-2">queryResult</span><span class="hl-1">.</span><span class="hl-2">records</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">cursor:</span><span class="hl-1"> </span><span class="hl-2">queryResult</span><span class="hl-1">.</span><span class="hl-2">cursor</span><span class="hl-1">,</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">}</span>
</code></pre>
<p>We can also use the alias <code>byTeamDueDate</code> instead of <code>GSI1</code> for readability.</p>
<pre><code class="language-diff"><span class="hl-1">export async function getPastDueTasks(teamId: string) {</span><br/><span class="hl-1">    const today = new Date();</span><br/><span class="hl-3">-    const queryResult = await TaskFacet.GSI1.query({ teamId }).lessThan({</span><br/><span class="hl-8">+    const queryResult = await TaskFacet.byTeamDueDate.query({ teamId }).lessThan({</span><br/><span class="hl-1">        dateDue: today,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    return {</span><br/><span class="hl-1">        tasks: queryResult.records,</span><br/><span class="hl-1">        cursor: queryResult.cursor,</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">}</span><br/>
</code></pre>
<p>This enables another required access pattern.</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they were created&quot;</em></li>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they are due&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they were created&quot;</em></li>
<li><input disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they are due&quot;</em></li>
</ul>
<p>For the last two we&#39;ll need two more indexes.</p>
<pre><code class="language-ts"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Facet</span><span class="hl-1">, </span><span class="hl-2">Index</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&quot;@faceteer/facet&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-4">const</span><span class="hl-1"> </span><span class="hl-6">TaskFacet</span><span class="hl-1"> = </span><span class="hl-4">new</span><span class="hl-1"> </span><span class="hl-7">Facet</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;taskId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">connection:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-2">dynamoDb:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbClient</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">tableName:</span><span class="hl-1"> </span><span class="hl-2">dynamoDbTableName</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-2">validator:</span><span class="hl-1"> </span><span class="hl-2">taskValidator</span><span class="hl-1">,</span><br/><span class="hl-1">})</span><br/><span class="hl-1">  .</span><span class="hl-7">addIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">index:</span><span class="hl-1"> </span><span class="hl-2">Index</span><span class="hl-1">.</span><span class="hl-6">GSI1</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;teamId&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TEAM&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;dateDue&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK_DUE&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">alias:</span><span class="hl-1"> </span><span class="hl-3">&quot;byTeamDueDate&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-7">addIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">index:</span><span class="hl-1"> </span><span class="hl-2">Index</span><span class="hl-1">.</span><span class="hl-6">GSI2</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;assignedUserId&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;status&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#USER_STATUS&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;dateCreated&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK_CREATED&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">alias:</span><span class="hl-1"> </span><span class="hl-3">&quot;byUserStatusCreated&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">  .</span><span class="hl-7">addIndex</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-2">index:</span><span class="hl-1"> </span><span class="hl-2">Index</span><span class="hl-1">.</span><span class="hl-6">GSI3</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-2">PK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;assignedUserId&quot;</span><span class="hl-1">, </span><span class="hl-3">&quot;status&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#USER_STATUS&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">SK:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-2">keys:</span><span class="hl-1"> [</span><span class="hl-3">&quot;dateDue&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">      </span><span class="hl-2">prefix:</span><span class="hl-1"> </span><span class="hl-3">&quot;#TASK_DUE&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-2">alias:</span><span class="hl-1"> </span><span class="hl-3">&quot;byUserStatusDue&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span>
</code></pre>
<ul>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they were created&quot;</em></li>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by team ordered by the date they are due&quot;</em></li>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they were created&quot;</em></li>
<li><input checked="" disabled="" type="checkbox"> <em>&quot;List tasks by user and by status ordered by the date they are due&quot;</em></li>
</ul>

<a href="#pagination" id="pagination" style="color: inherit; text-decoration: none;">
  <h3>Pagination</h3>
</a>

<a href="#faqs" id="faqs" style="color: inherit; text-decoration: none;">
  <h2>FAQs</h2>
</a>

<a href="#best-practices" id="best-practices" style="color: inherit; text-decoration: none;">
  <h2>Best Practices</h2>
</a>
<pre><code>
</code></pre>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/Index.html" class="tsd-kind-icon">Index</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Facet.html" class="tsd-kind-icon">Facet</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/FacetIndex.html" class="tsd-kind-icon">Facet<wbr/>Index</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/PartitionQuery.html" class="tsd-kind-icon">Partition<wbr/>Query</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/AddIndexOptions.html" class="tsd-kind-icon">Add<wbr/>Index<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/DeleteFailure.html" class="tsd-kind-icon">Delete<wbr/>Failure</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/DeleteOptions.html" class="tsd-kind-icon">Delete<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/DeleteResponse.html" class="tsd-kind-icon">Delete<wbr/>Response</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/FacetOptions.html" class="tsd-kind-icon">Facet<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/KeyConfiguration.html" class="tsd-kind-icon">Key<wbr/>Configuration</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/PartitionQueryOptions.html" class="tsd-kind-icon">Partition<wbr/>Query<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/PutFailure.html" class="tsd-kind-icon">Put<wbr/>Failure</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/PutOptions.html" class="tsd-kind-icon">Put<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/PutResponse.html" class="tsd-kind-icon">Put<wbr/>Response</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/PutSingleItemResponse.html" class="tsd-kind-icon">Put<wbr/>Single<wbr/>Item<wbr/>Response</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/QueryOptions.html" class="tsd-kind-icon">Query<wbr/>Options</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/QueryResult.html" class="tsd-kind-icon">Query<wbr/>Result</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/ShardConfiguration.html" class="tsd-kind-icon">Shard<wbr/>Configuration</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#FacetWithIndex" class="tsd-kind-icon">Facet<wbr/>With<wbr/>Index</a></li><li class="tsd-kind-type-alias tsd-has-type-parameter"><a href="modules.html#Validator" class="tsd-kind-icon">Validator</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>